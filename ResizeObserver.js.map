{"version":3,"sources":["src/ResizeObserver.js"],"names":["style","position","left","top","right","bottom","overflow","zIndex","visibility","pointerEvents","styleChild","transition","isAncestor","node","ancestor","current","parentNode","ResizeObserver","event","length","_scrollListeners","i","call","undefined","_resizeListeners","listener","document","addEventListener","_handleScroll","subscribed","push","removeScrollListener","splice","indexOf","removeEventListener","window","_handleResize","removeSResizeListener","props","context","bind","_reflow","_handleRef","_handleExpandRef","_handleShrinkRef","_removeScroll","addScrollListener","onPosition","onReflow","_removeResize","addResizeListener","nextProps","onResize","_globalScollTarget","target","_refScrollTarget","_ancestorScollTarget","documentElement","body","_expandRef","_shrinkRef","width","offsetWidth","height","offsetHeight","_lastWidth","_lastHeight","_reset","_node","Element","rect","getBoundingClientRect","sizeChanged","_lastRect","positionChanged","scrollLeft","scrollTop","React","Component"],"mappings":"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","sourcesContent":["// @flow\n/* eslint-disable complexity */\n\n// =============================================================================\n// Import modules.\n// =============================================================================\nimport React from 'react';\n\nconst style = {\n  position: 'absolute',\n  left: 0,\n  top: 0,\n  right: 0,\n  bottom: 0,\n  overflow: 'hidden',\n  zIndex: -1,\n  visibility: 'hidden',\n  pointerEvents: 'none',\n};\nconst styleChild = {\n  position: 'absolute',\n  left: 0,\n  top: 0,\n  transition: '0s',\n};\n\nfunction isAncestor(node: Object, ancestor: Object) {\n  let current = node.parentNode;\n\n  while (current) {\n    if (current === ancestor) {\n      return true;\n    }\n\n    current = current.parentNode;\n  }\n\n  return false;\n}\n\nexport type Props = {\n  onResize?: (ClientRect) => mixed,\n  onPosition?: (ClientRect) => mixed,\n  onReflow?: (ClientRect) => mixed,\n};\n\nclass ResizeObserver extends React.Component<Props> {\n  static displayName = 'ResizeObserver';\n  static _scrollListeners: Array<(event: Event) => mixed> = [];\n  static _resizeListeners: Array<(event: Event) => mixed> = [];\n\n  static _handleScroll(event: Event) {\n    const length = ResizeObserver._scrollListeners.length;\n    for (let i = 0; i < length; i++) {\n      ResizeObserver._scrollListeners[i].call(undefined, event);\n    }\n  }\n\n  static _handleResize(event: Event) {\n    const length = ResizeObserver._resizeListeners.length;\n    for (let i = 0; i < length; i++) {\n      ResizeObserver._resizeListeners[i].call(undefined, event);\n    }\n  }\n\n  static addScrollListener(listener: (event: Event) => mixed): () => void {\n    if (ResizeObserver._scrollListeners.length === 0) {\n      document.addEventListener('scroll', ResizeObserver._handleScroll, true);\n    }\n\n    let subscribed = true;\n\n    ResizeObserver._scrollListeners.push(listener);\n\n    return function removeScrollListener() {\n      if (!subscribed) return;\n\n      subscribed = false;\n\n      ResizeObserver._scrollListeners\n        .splice(ResizeObserver._scrollListeners.indexOf(listener), 1);\n\n      if (ResizeObserver._scrollListeners.length === 0) {\n        document.removeEventListener(\n          'scroll',\n          ResizeObserver._handleScroll,\n          true\n        );\n      }\n    };\n  }\n\n  static addResizeListener(listener: (event: Event) => mixed): () => void {\n    if (ResizeObserver._resizeListeners.length === 0) {\n      window.addEventListener('resize', ResizeObserver._handleResize, true);\n    }\n\n    let subscribed = true;\n\n    ResizeObserver._resizeListeners.push(listener);\n\n    return function removeSResizeListener() {\n      if (!subscribed) return;\n\n      subscribed = false;\n\n      ResizeObserver._resizeListeners\n        .splice(ResizeObserver._resizeListeners.indexOf(listener), 1);\n\n      if (ResizeObserver._resizeListeners.length === 0) {\n        window.removeEventListener(\n          'resize',\n          ResizeObserver._handleResize,\n          true\n        );\n      }\n    };\n  }\n\n  _expandRef: HTMLElement | null = null;\n  _shrinkRef: HTMLElement | null = null;\n  _node: HTMLElement | null = null;\n  _lastWidth: ?number;\n  _lastHeight: ?number;\n  _removeResize: ?() => void;\n  _removeScroll: ?() => void;\n  _lastRect: Object = {};\n\n  constructor(props: Props, context: any) {\n    super(props, context);\n    (this: any)._handleScroll = this._handleScroll.bind(this);\n    (this: any)._reflow = this._reflow.bind(this);\n    (this: any)._handleRef = this._handleRef.bind(this);\n    (this: any)._handleExpandRef = this._handleExpandRef.bind(this);\n    (this: any)._handleShrinkRef = this._handleShrinkRef.bind(this);\n  }\n\n  componentDidMount() {\n    this._reflow();\n\n    this._removeScroll = ResizeObserver.addScrollListener(this._handleScroll);\n\n    if (this.props.onPosition || this.props.onReflow) {\n      this._removeResize = ResizeObserver.addResizeListener(this._reflow);\n    }\n  }\n\n  componentWillReceiveProps(nextProps: Props) {\n    if ((nextProps.onPosition || nextProps.onReflow) && !this._removeResize) {\n      this._removeResize = ResizeObserver.addResizeListener(this._reflow);\n    } else if (\n      !(nextProps.onPosition || nextProps.onReflow) &&\n      this._removeResize\n    ) {\n      this._removeResize();\n      this._removeResize = null;\n    }\n  }\n\n  componentWillUnmount() {\n    if (this._removeScroll) {\n      this._removeScroll();\n      this._removeScroll = null;\n    }\n\n    if (this._removeResize) {\n      this._removeResize();\n      this._removeResize = null;\n    }\n  }\n\n  _handleScroll(event: Event) {\n    if (\n      (this.props.onPosition || this.props.onReflow || this.props.onResize) && (\n        this._globalScollTarget(event.target) ||\n        this._refScrollTarget(event.target) ||\n        this._ancestorScollTarget(event.target)\n      )\n    ) {\n      this._reflow();\n    }\n  }\n\n  _globalScollTarget(target: EventTarget) {\n    return (this.props.onPosition || this.props.onReflow) && (\n      target === document ||\n      target === document.documentElement ||\n      target === document.body\n    );\n  }\n\n  _refScrollTarget(target: EventTarget) {\n    if (target === this._expandRef || target === this._shrinkRef) {\n      const width = (target: any).offsetWidth;\n      const height = (target: any).offsetHeight;\n\n      if (width !== this._lastWidth || height !== this._lastHeight) {\n        this._lastWidth = width;\n        this._lastHeight = height;\n        this._reset(this._expandRef);\n        this._reset(this._shrinkRef);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  _ancestorScollTarget(target: EventTarget) {\n    return (this.props.onPosition || this.props.onReflow) &&\n      this._node && isAncestor(this._node, target);\n  }\n\n  _reflow() {\n    if (!this._node || !(this._node.parentNode instanceof Element)) return;\n\n    const rect = this._node.parentNode.getBoundingClientRect();\n\n    const sizeChanged =\n      rect.width !== this._lastRect.width ||\n      rect.height !== this._lastRect.height;\n\n    const positionChanged =\n      rect.top !== this._lastRect.top ||\n      rect.left !== this._lastRect.left;\n\n    this._lastRect = rect;\n\n    if (sizeChanged && this.props.onResize) {\n      this.props.onResize(rect);\n    }\n\n    if (positionChanged && this.props.onPosition) {\n      this.props.onPosition(rect);\n    }\n\n    if ((sizeChanged || positionChanged) && this.props.onReflow) {\n      this.props.onReflow(rect);\n    }\n  }\n\n  _reset(node: HTMLElement | null) {\n    if (node) {\n      node.scrollLeft = 100000;\n      node.scrollTop = 100000;\n    }\n  }\n\n  _handleRef(node: HTMLElement | null) {\n    this._node = node;\n  }\n\n  _handleExpandRef(node: HTMLElement | null) {\n    this._reset(node);\n    this._expandRef = node;\n  }\n\n  _handleShrinkRef(node: HTMLElement | null) {\n    this._reset(node);\n    this._shrinkRef = node;\n  }\n\n  render() {\n    if (this.props.onResize || this.props.onReflow) {\n      return (\n        <div style={style} ref={this._handleRef}>\n          <div ref={this._handleExpandRef} style={style}>\n            <div style={{...styleChild, width: 100000, height: 100000}}/>\n          </div>\n          <div ref={this._handleShrinkRef} style={style}>\n            <div style={{...styleChild, width: '200%', height: '200%'}}/>\n          </div>\n        </div>\n      );\n    }\n\n    return <noscript/>;\n  }\n}\n\nexport default ResizeObserver;\n"],"file":"ResizeObserver.js"}